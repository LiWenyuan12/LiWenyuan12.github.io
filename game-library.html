<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox 游盒 - 游戏库</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0d1117;
      --card: #161b22;
      --border: #30363d;
      --text: #c9d1d9;
      --text-muted: #8b949e;
      --accent: #58a6ff;
    }
    body { margin:0; font-family: system-ui, sans-serif; background:var(--bg); color:var(--text); line-height:1.6; }
    .page { max-width:1400px; margin:0 auto; padding:20px; display:grid; grid-template-columns:1fr 300px; gap:24px; }
    @media (max-width:1080px) { .page { grid-template-columns:1fr; } }
    .header { background:#010409; padding:12px 20px; position:sticky; top:0; z-index:10; border-bottom:1px solid var(--border); }
    .header-inner { display:flex; align-items:center; justify-content:space-between; max-width:1400px; margin:0 auto; }
    .logo { display:flex; align-items:center; gap:12px; color:white; text-decoration:none; font-size:20px; font-weight:bold; }
    .logo-mark { width:40px; height:40px; background:#58a6ff; border-radius:8px; display:grid; place-items:center; font-size:24px; }
    .nav-main { display:flex; gap:24px; }
    .nav-link { color:var(--text-muted); text-decoration:none; }
    .nav-link:hover, .nav-link[data-page="library"] { color:white; }
    .header-search { position:relative; }
    .header-search input { padding:8px 32px 8px 12px; border-radius:6px; border:none; background:#30363d; color:white; width:280px; }
    .header-search-icon { position:absolute; right:10px; top:50%; transform:translateY(-50%); pointer-events:none; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
    .card-header { padding:16px 20px; background:#0d1117; display:flex; justify-content:space-between; align-items:center; }
    .card-title { font-size:18px; font-weight:600; display:flex; align-items:center; gap:8px; }
    .dot { width:8px; height:8px; background:var(--accent); border-radius:50%; }
    .form { padding:20px; display:grid; gap:16px; }
    .form-row { display:grid; gap:8px; }
    label { font-size:14px; color:var(--text-muted); }
    input, select { padding:10px; border-radius:6px; border:none; background:#30363d; color:white; }
    .game-list { display:grid; grid-template-columns:repeat(auto-fill, minmax(320px, 1fr)); gap:16px; padding:20px; }
    .game-card { background:var(--card); border:1px solid var(--border); border-radius:8px; overflow:hidden; cursor:pointer; transition:0.2s; display:flex; }
    .game-card:hover { transform:translateY(-4px); box-shadow:0 8px 25px rgba(0,0,0,0.5); }
    .game-cover { width:120px; height:160px; background:#000 center/cover no-repeat; flex-shrink:0; }
    .game-info { padding:12px; display:grid; gap:4px; }
    .game-name { font-weight:600; font-size:15px; }
    .game-desc { font-size:13px; color:var(--text-muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .game-meta { font-size:13px; color:var(--accent); }
    .price { font-size:14px; font-weight:bold; color:#79c0ff; }
    .tag { font-size:11px; padding:2px 8px; background:#21262d; border-radius:4px; }
    .tag--accent { background:#1f6feb; }
    .chip { background:#21262d; padding:4px 10px; border-radius:999px; font-size:13px; }
  </style>
</head>
<body data-current-page="library">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox 游盒</div>
          <div style="font-size:12px;color:#8b949e;">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>
      <nav class="nav-main">
        <a href="index.html" class="nav-link">首页</a>
        <a href="game-library.html" data-page="library" class="nav-link" style="color:white;">游戏库</a>
        <a href="ranking.html" class="nav-link">排行榜 <span style="background:#f85149;color:white;padding:2px 6px;border-radius:4px;font-size:10px;">HOT</span></a>
      </nav>
      <div style="display:flex;gap:12px;align-items:center;">
        <div class="header-search">
          <input type="text" placeholder="搜索游戏名…" />
          <span class="header-search-icon">Search</span>
        </div>
      </div>
    </div>
  </header>

  <main class="main" style="grid-column:1/3;">
    <div class="card">
      <div style="padding:20px;">
        <h1 style="margin:0;font-size:28px;">游戏库</h1>
        <p style="margin:8px 0 0;color:var(--text-muted);">共收录 120+ 款热门游戏，支持多条件筛选</p>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title"><span class="dot"></span> 筛选条件</div>
      </div>
      <div class="form">
        <div class="form-row">
          <label for="libSearch">游戏名搜索</label>
          <input type="text" id="libSearch" placeholder="例如：原神、艾尔登法环、黑神话" />
        </div>

        <div class="form-row">
          <label for="libType">游戏类型</label>
          <select id="libType">
            <option value="all">全部类型</option>
            <option value="开放世界">开放世界</option>
            <option value="动作">动作 / ACT</option>
            <option value="RPG">角色扮演 / RPG</option>
            <option value="魂类">魂类</option>
            <option value="射击">射击 / FPS</option>
            <option value="卡牌">卡牌 / Roguelike</option>
            <option value="模拟经营">模拟经营 / 沙盒</option>
            <option value="策略">策略 / SLG</option>
            <option value="合作">合作 / 联机</option>
            <option value="免费">免费游戏</option>
          </select>
        </div>

        <div class="form-row">
          <label for="libPrice">价格区间</label>
          <select id="libPrice">
            <option value="all">全部价格</option>
            <option value="free">免费游戏</option>
            <option value="low">¥100 以下</option>
            <option value="mid">¥100 - ¥300</option>
            <option value="high">¥300 以上</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title"><span class="dot"></span> 筛选结果</div>
        <div class="chip" id="libResultCount">加载中…</div>
      </div>
      <div id="libList" class="game-list">
        <!-- JS 动态填充 -->
      </div>
    </div>
  </main>
</div>

<script>
  // ==================== 数据和工具函数 ====================
  let gameData = [];

  const libSearch = document.getElementById("libSearch");
  const libType   = document.getElementById("libType");
  const libPrice  = document.getElementById("libPrice");
  const libList   = document.getElementById("libList");
  const libResultCount = document.getElementById("libResultCount");

  // 简单判断是否免费
  function isFree(priceStr) {
    return priceStr.includes("免费") || priceStr === "¥0";
  }

  // 提取价格数字（处理 “¥268”、“免费内购” 等情况）
  function getPriceNum(priceStr) {
    if (isFree(priceStr)) return 0;
    const match = priceStr.match(/¥(\d+)/);
    return match ? parseInt(match[1]) : 9999;
  }

  // 渲染函数
  function renderList() {
    let filtered = gameData;

    // 搜索关键词
    const kw = libSearch.value.trim();
    if (kw) {
      filtered = filtered.filter(g => 
        g.name.toLowerCase().includes(kw.toLowerCase()) ||
        g.description.toLowerCase().includes(kw.toLowerCase())
      );
    }

    // 类型筛选
    if (libType.value !== "all") {
      filtered = filtered.filter(g => g.type.includes(libType.value));
    }

    // 价格筛选
    if (libPrice.value === "free") {
      filtered = filtered.filter(g => isFree(g.price));
    } else if (libPrice.value === "low") {
      filtered = filtered.filter(g => getPriceNum(g.price) > 0 && getPriceNum(g.price) <= 100);
    } else if (libPrice.value === "mid") {
      filtered = filtered.filter(g => {
        const p = getPriceNum(g.price);
        return p > 100 && p <= 300;
      });
    } else if (libPrice.value === "high") {
      filtered = filtered.filter(g => getPriceNum(g.price) > 300);
    }

    // 去重（id 可能重复的原神之类）
    const seen = new Set();
    filtered = filtered.filter(g => {
      if (seen.has(g.id)) return false;
      seen.add(g.id);
      return true;
    });

    // 更新数量
    libResultCount.textContent = `共 ${filtered.length} 款`;

    // 清空
    libList.innerHTML = "";

    if (filtered.length === 0) {
      libList.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:var(--text-muted); padding:40px;">没有找到符合条件的游戏，试试放宽条件吧</div>`;
      return;
    }

    filtered.forEach(g => {
      const div = document.createElement("div");
      div.className = "game-card";

      div.innerHTML = `
        <div class="game-cover" style="background-image:url('${g.cover}')"></div>
        <div class="game-info">
          <div class="game-name">${g.name}</div>
          <div class="game-desc">${g.description}</div>
          <div class="game-meta">
            ${g.type} • 评分 <strong>${g.rating}</strong> • 热度 ${g.hotness}
          </div>
          <div style="margin-top:8px;">
            <span class="price">${g.price}</span>
            ${isFree(g.price) ? '<span class="tag tag--accent">免费</span>' : ''}
          </div>
        </div>
      `;

      div.onclick = () => alert(`即将跳转到《${g.name}》详情页（示例）`);
      libList.appendChild(div);
    });
  }

  // ==================== 加载数据 ====================
  fetch("games-library.json")
    .then(res => {
      if (!res.ok) throw new Error("文件没找到");
      return res.json();
    })
    .then(data => {
      gameData = data;           // 关键：直接就是数组
      renderList();              // 第一次渲染
    })
    .catch(err => {
      console.error(err);
      libList.innerHTML = `<div style="color:red;padding:20px;">加载失败：${err.message}请检查 games-library-array.json 是否在同目录</div>`;
    });

  // ==================== 监听筛选 ====================
  libSearch.addEventListener("input", renderList);
  libType.addEventListener("change", renderList);
  libPrice.addEventListener("change", renderList);

  // 支持 URL 参数直接筛选（比如从首页点“免费游戏”跳转过来）
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has("type")) libType.value = urlParams.get("type");
  if (urlParams.has("price")) libPrice.value = urlParams.get("price");
  if (urlParams.has("kw")) {
    libSearch.value = urlParams.get("kw");
  }
</script>
</body>
</html>
