<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox 游盒 - 游戏库</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
</head>

<body data-current-page="library">
<div class="page">
  <header class="header">
    <!-- 你原来的完整 header 保持 100% 不变 -->
    ...（全部保留不变）
  header>

  <main class="main">
    <section>
      <div class="card">
        <div class="page-title">游戏库div>
        <div class="page-intro">
          通过名称、类型、平台和价格区间来筛选你感兴趣的游戏（示例数据）。
        div>
      div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot">span>
            <span>筛选条件span>
          div>
        header>

        <div class="form">
          <div class="form-row">
            <label for="libSearch">按名称搜索label>
            <input type="text" id="libSearch" placeholder="输入游戏名，如：艾尔登法环" />
          div>

          <div class="form-row">
            <label for="libType">类型label>
            <select id="libType">
              <option value="all">全部类型option>
              <option value="开放世界">开放世界option>
              <option value="动作">动作option>
              <option value="回合制RPG">回合制RPGoption>
              <option value="魂类">魂类option>
              <option value="模拟经营">模拟经营option>
              <option value="沙盒">沙盒option>
              <option value="Roguelike">Roguelikeoption>
              <option value="卡牌Roguelike">卡牌Roguelikeoption>
              <!-- 根据你数据里实际出现的类型加了几个常用 -->
            select>
          div>

          <div class="form-row">
            <label for="libPrice">价格区间label>
            <select id="libPrice">
              <option value="all">全部option>
              <option value="free">免费 / F2Poption>
              <option value="low">100 元以下option>
              <option value="high">100 元以上option>
            select>
          div>
        div>
      div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot">span>
            <span>筛选结果span>
          div>
          <div class="chip" id="libResultCount">共 0 款div>
        header>
        <div id="libList" class="game-list">div>
      div>
    section>

    <aside>
      <!-- 你原来的侧边栏保持不变 -->
      ...
    aside>
  main>
div>

<script src="common.js">script>
<script>
  initCommon();

  let gameData = [];

  const libSearch = document.getElementById("libSearch");
  const libType   = document.getElementById("libType");
  const libPrice  = document.getElementById("libPrice");
  const libList   = document.getElementById("libList");
  const libResultCount = document.getElementById("libResultCount");

  // 判断是否免费
  function isFree(price) {
    return price.includes("免费") || price === "买断"; // 逃离塔科夫那种也算免费试玩
  }

  // 提取价格数字，用于范围判断
  function getPriceNum(price) {
    if (isFree(price)) return 0;
    const m = price.match(/¥(\d+)/);
    return m ? parseInt(m[1]) : 99999;
  }

  function renderList() {
    let list = gameData;

    // 关键词搜索
    const kw = libSearch.value.trim().toLowerCase();
    if (kw) {
      list = list.filter(g => g.name.toLowerCase().includes(kw) || g.description.toLowerCase().includes(kw));
    }

    // 类型筛选
    if (libType.value !== "all") {
      list = list.filter(g => g.type === libType.value);
    }

    // 价格筛选
    if (libPrice.value === "free") {
      list = list.filter(g => isFree(g.price));
    } else if (libPrice.value === "low") {
      list = list.filter(g => getPriceNum(g.price) > 0 && getPriceNum(g.price) <= 100);
    } else if (libPrice.value === "high") {
      list = list.filter(g => getPriceNum(g.price) > 100);
    }

    libResultCount.textContent = `共 ${list.length} 款`;
    libList.innerHTML = "";

    if (list.length === 0) {
      libList.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted);">没有找到符合条件的游戏div>';
      return;
    }

    list.forEach(g => {
      const div = document.createElement("div");
      div.className = "game-card";

      div.innerHTML = `
        <div class="game-cover" style="background-image: url('${g.cover}')">div>
        <div class="game-info">
          <div class="game-name">${g.name}div>
          <div class="game-meta">
            ${g.type} • 评分 ${g.rating} • ${g.price}
          div>
          <div class="game-desc">${g.description}div>
        div>
      `;

      libList.appendChild(div);
    });
  }

  // ==================== 关键修复：正确加载你的数组 JSON ====================
  fetch("games-library-array.json")   // 确保文件名和你放的一样
    .then(r => r.json())
    .then(data => {
      gameData = data;        // 直接赋值数组，不要 .games！
      renderList();           // 加载完立即渲染
    })
    .catch(err => {
      console.error(err);
      libList.innerHTML = "加载游戏数据失败，请检查 games-library-array.json 是否存在";
    });

  // 监听筛选条件
  libSearch.addEventListener("input", renderList);
  libType.addEventListener("change", renderList);
  libPrice.addEventListener("change", renderList);
script>

body>
html>
