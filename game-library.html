<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox 游盒 - 游戏库</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="library">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox 游盒</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">首页</a>
        <a href="news-list.html" data-page="news" class="nav-link">资讯</a>
        <a href="game-library.html" data-page="library" class="nav-link">游戏库</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          排行榜 <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">折扣 / 史低</a>
        <a href="community.html" data-page="community" class="nav-link">社区</a>
        <a href="my-library.html" data-page="my" class="nav-link">我的游戏</a>
        <a href="tools.html" data-page="tools" class="nav-link">工具中心</a>
        <a href="profile.html" data-page="profile" class="nav-link">用户中心</a>
      </nav>

      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="搜索游戏 / 资讯 / 帖子" />
          <span class="header-search-icon">Search</span>
        </div>
        <button class="header-user">未登录 · 游客</button>
      </div>
    </div>
  </header>

  <main class="main">
    <section>
      <div class="card">
        <div class="page-title">游戏库</div>
        <div class="page-intro">
          通过名称、类型、平台和价格区间来筛选你感兴趣的游戏（示例数据）。
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>筛选条件</span>
          </div>
        </header>

        <div class="form">
          <div class="form-row">
            <label for="libSearch">按名称搜索</label>
            <input type="text" id="libSearch" placeholder="输入游戏名，如：艾尔登法环" />
          </div>

          <div class="form-row">
            <label for="libType">类型</label>
            <select id="libType">
              <option value="all">全部类型</option>
              <option value="开放世界">开放世界</option>
              <option value="动作">动作</option>
              <option value="魂类">魂类</option>
              <option value="回合制RPG">回合制RPG</option>
              <option value="模拟经营">模拟经营</option>
              <option value="沙盒">沙盒</option>
              <option value="Roguelike">Roguelike</option>
              <option value="卡牌Roguelike">卡牌Roguelike</option>
              <option value="生存">生存</option>
              <option value="策略">策略</option>
            </select>
          </div>

          <div class="form-row">
            <label for="libPrice">价格区间</label>
            <select id="libPrice">
              <option value="all">全部</option>
              <option value="free">免费 / F2P</option>
              <option value="low">100 元以下</option>
              <option value="high">100 元以上</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>筛选结果</span>
          </div>
          <div class="chip" id="libResultCount">共 0 款</div>
        </header>
        <div id="libList" class="game-list"></div>
      </div>
    </section>

    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">小提示</div>
        <div class="sidebar-item">
          <span class="label">可与首页分类联动</span>
          <span class="value">支持</span>
        </div>
        <div class="sidebar-item">
          <span class="label">数据来源</span>
          <span class="value">示例假数据</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<script src="common.js"></script>
<script>
  initCommon();

  let gameData = [];

  const libSearch = document.getElementById("libSearch");
  const libType   = document.getElementById("libType");
  const libPrice  = document.getElementById("libPrice");
  const libList   = document.getElementById("libList");
  const libResultCount = document.getElementById("libResultCount");

  function renderList() {
    let filtered = gameData;

    // 关键词搜索
    const kw = libSearch.value.trim();
    if (kw) {
      filtered = filtered.filter(g =>
        g.name.includes(kw) || g.description.includes(kw)
      );
    }

    // 类型筛选
    if (libType.value !== "all") {
      filtered = filtered.filter(g => g.type === libType.value);
    }

    // 价格筛选
    if (libPrice.value === "free") {
      filtered = filtered.filter(g => g.price.includes("免费"));
    } else if (libPrice.value === "low") {
      filtered = filtered.filter(g => {
        const match = g.price.match(/¥(\d+)/);
        return match && parseInt(match[1]) <= 100;
      });
    } else if (libPrice.value === "high") {
      filtered = filtered.filter(g => {
        const match = g.price.match(/¥(\d+)/);
        return match && parseInt(match[1]) > 100;
      });
    }

    libResultCount.textContent = `共 ${filtered.length} 款`;
    libList.innerHTML = "";

    if (filtered.length === 0) {
      libList.innerHTML = '<div style="text-align:center;padding:60px;color:#888;">没有找到符合条件的游戏</div>';
      return;
    }

    filtered.forEach(game => {
      const div = document.createElement("div");
      div.className = "game-card";

      div.innerHTML = `
        <div class="game-cover" style="background-image:url('${game.cover}')"></div>
        <div class="game-info">
          <div class="game-name">${game.name}</div>
          <div class="game-meta">
            ${game.type} • 评分 ${game.rating} • ${game.price}
          </div>
          <div class="game-desc">${game.description}</div>
        </div>
      `;

      libList.appendChild(div);
    });
  }

  // 关键修复：你的 JSON 就是一个数组，不是 { games: [...] }
  fetch("games-library.json")
    .then(res => res.json())
    .then(data => {
      gameData = data;        // 直接赋值数组
      renderList();
    })
    .catch(err => {
      console.error(err);
      libList.innerHTML = "<div style='color:red;padding:20px;'>加载失败：找不到 games-library-array.json</div>";
    });

  // 筛选事件
  libSearch.addEventListener("input", renderList);
  libType.addEventListener("change", renderList);
  libPrice.addEventListener("change", renderList);
</script>
</body>
</html>
